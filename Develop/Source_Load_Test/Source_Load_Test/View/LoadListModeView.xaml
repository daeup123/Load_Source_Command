<Window x:Class="Source_Load_Test.View.LoadListModeView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="리스트 모드 (List Mode) - Electronic Load"
        Height="770"
        Width="695"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="White">

    <Window.Resources>
        <!-- 섹션 헤더 스타일 -->
        <Style x:Key="SectionHeaderStyle"
               TargetType="Border">
            <Setter Property="Background"
                    Value="#E3F2FD" />
            <Setter Property="BorderBrush"
                    Value="#2196F3" />
            <Setter Property="BorderThickness"
                    Value="0,0,0,2" />
            <Setter Property="Padding"
                    Value="10,8" />
            <Setter Property="Margin"
                    Value="0,0,0,10" />
        </Style>

        <!-- 버튼 스타일 -->
        <Style x:Key="ActionButtonStyle"
               TargetType="Button">
            <Setter Property="Height"
                    Value="35" />
            <Setter Property="FontWeight"
                    Value="Bold" />
            <Setter Property="FontSize"
                    Value="12" />
            <Setter Property="Cursor"
                    Value="Hand" />
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- 상단 안내 메시지 -->
        <Border Grid.Row="0"
                Background="#E8F5E9"
                BorderBrush="#4CAF50"
                BorderThickness="2"
                Padding="12"
                Margin="0,0,0,15">
            <StackPanel>
                <StackPanel Orientation="Horizontal"
                            Margin="0,0,0,5">
                    <TextBlock Text="📋 "
                               FontSize="16" />
                    <TextBlock Text="리스트 모드란?"
                               FontWeight="Bold"
                               FontSize="13"
                               Foreground="#2E7D32"
                               VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock FontSize="11"
                           Foreground="#388E3C"
                           TextWrapping="Wrap"
                           LineHeight="16">
                    <Run Text="미리 정의된 전류값 시퀀스를 자동으로 순차 실행합니다." />
                    <LineBreak />
                    <Run Text="예) DUT(전원장치) 부하 변동 테스트: 1A → 3A → 5A → 2A → 반복" />
                    <LineBreak />
                    <Run Text="각 스텝마다 지속 시간을 설정할 수 있습니다." />
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- 메인 설정 영역 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="200" />
            </Grid.ColumnDefinitions>

            <!-- 왼쪽: 리스트 테이블 -->
            <Border Grid.Column="0"
                    BorderBrush="#BDBDBD"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- 테이블 헤더 -->
                    <Border Grid.Row="0"
                            Background="#2196F3"
                            Padding="8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="50" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="60" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                       Text="Step"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="12" />
                            <TextBlock Grid.Column="1"
                                       Text="Current (A)"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="12" />
                            <TextBlock Grid.Column="2"
                                       Text="Duration (s)"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="12" />
                            <TextBlock Grid.Column="3"
                                       Text="Action"
                                       Foreground="White"
                                       FontWeight="Bold"
                                       FontSize="12"
                                       HorizontalAlignment="Center" />
                        </Grid>
                    </Border>

                    <!-- 리스트 항목 (DataGrid) -->
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding ListSteps}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              SelectionMode="Single"
                              SelectedItem="{Binding SelectedStep}"
                              HeadersVisibility="None"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#E0E0E0"
                              BorderThickness="0">
                        <DataGrid.Columns>
                            <!-- Step 번호 -->
                            <DataGridTextColumn Header="Step"
                                                Width="50"
                                                Binding="{Binding StepNumber}"
                                                IsReadOnly="True">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="HorizontalAlignment"
                                                Value="Center" />
                                        <Setter Property="VerticalAlignment"
                                                Value="Center" />
                                        <Setter Property="FontWeight"
                                                Value="Bold" />
                                        <Setter Property="Foreground"
                                                Value="#1976D2" />
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <!-- 전류값 입력 -->
                            <DataGridTemplateColumn Header="Current"
                                                    Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding Current, UpdateSourceTrigger=PropertyChanged}"
                                                     BorderThickness="0"
                                                     Padding="8,5"
                                                     FontSize="12"
                                                     HorizontalContentAlignment="Right" />
                                            <TextBlock Grid.Column="1"
                                                       Text=" A"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"
                                                       Foreground="Gray" />
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- 지속시간 입력 -->
                            <DataGridTemplateColumn Header="Duration"
                                                    Width="*">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding Duration, UpdateSourceTrigger=PropertyChanged}"
                                                     BorderThickness="0"
                                                     Padding="8,5"
                                                     FontSize="12"
                                                     HorizontalContentAlignment="Right" />
                                            <TextBlock Grid.Column="1"
                                                       Text=" s"
                                                       VerticalAlignment="Center"
                                                       Margin="0,0,8,0"
                                                       Foreground="Gray" />
                                        </Grid>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- 삭제 버튼 -->
                            <DataGridTemplateColumn Header="Action"
                                                    Width="60">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="✕"
                                                Background="#FFEBEE"
                                                Foreground="#C62828"
                                                BorderBrush="#EF5350"
                                                FontSize="14"
                                                FontWeight="Bold"
                                                Width="30"
                                                Height="25"
                                                Command="{Binding DataContext.RemoveStepCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- 하단 추가 버튼 영역 -->
                    <Border Grid.Row="2"
                            Background="#F5F5F5"
                            BorderBrush="#BDBDBD"
                            BorderThickness="0,1,0,0"
                            Padding="10">
                        <StackPanel Orientation="Horizontal"
                                    HorizontalAlignment="Center">
                            <Button Content="➕ Add Step"
                                    Background="#4CAF50"
                                    Foreground="White"
                                    Style="{StaticResource ActionButtonStyle}"
                                    Width="120"
                                    Command="{Binding AddStepCommand}" />
                            <Button Content="🗑 Clear All"
                                    Background="#FF9800"
                                    Foreground="White"
                                    Style="{StaticResource ActionButtonStyle}"
                                    Width="120"
                                    Margin="10,0,0,0"
                                    Command="{Binding ClearAllStepsCommand}" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- 오른쪽: 제어 패널 -->
            <StackPanel Grid.Column="2">
                <!-- 리스트 실행 설정 -->
                <Border Style="{StaticResource SectionHeaderStyle}">
                    <TextBlock Text="실행 설정"
                               FontWeight="Bold"
                               FontSize="12"
                               Foreground="#1976D2" />
                </Border>

                <!-- 반복 모드 -->
                <Border BorderBrush="#BDBDBD"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="반복 모드"
                                   FontWeight="Bold"
                                   FontSize="11"
                                   Margin="0,0,0,5" />
                        <RadioButton Content="단일 실행"
                                     IsChecked="{Binding IsOneShot}"
                                     GroupName="RepeatMode"
                                     Margin="0,3" />
                        <RadioButton Content="연속 반복"
                                     IsChecked="{Binding IsContinuous}"
                                     GroupName="RepeatMode"
                                     Margin="0,3" />
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,8,0,0">
                            <RadioButton Content="반복 횟수:"
                                         IsChecked="{Binding IsRepeatCount}"
                                         GroupName="RepeatMode"
                                         VerticalAlignment="Center" />
                            <TextBox Text="{Binding RepeatCount, UpdateSourceTrigger=PropertyChanged}"
                                     Width="50"
                                     Margin="5,0,0,0"
                                     IsEnabled="{Binding IsRepeatCount}"
                                     HorizontalContentAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- 현재 상태 표시 -->
                <Border Background="#E3F2FD"
                        BorderBrush="#2196F3"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="현재 상태"
                                   FontWeight="Bold"
                                   FontSize="11"
                                   Foreground="#1976D2"
                                   Margin="0,0,0,5" />
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,3">
                            <TextBlock Text="실행 중인 Step: "
                                       FontSize="10"
                                       Foreground="Gray" />
                            <TextBlock Text="{Binding CurrentStep}"
                                       FontSize="10"
                                       FontWeight="Bold"
                                       Foreground="#1976D2" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,3">
                            <TextBlock Text="진행률: "
                                       FontSize="10"
                                       Foreground="Gray" />
                            <TextBlock Text="{Binding Progress}"
                                       FontSize="10"
                                       FontWeight="Bold"
                                       Foreground="#1976D2" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal"
                                    Margin="0,3">
                            <TextBlock Text="반복 횟수: "
                                       FontSize="10"
                                       Foreground="Gray" />
                            <TextBlock Text="{Binding CurrentRepeat}"
                                       FontSize="10"
                                       FontWeight="Bold"
                                       Foreground="#1976D2" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- 프로그래스 바 -->
                <ProgressBar Height="25"
                             Value="{Binding ProgressPercentage}"
                             Maximum="100"
                             Margin="0,0,0,15" />

                <!-- 실행 제어 버튼 -->
                <Button Content="▶ 리스트 실행"
                        Background="#4CAF50"
                        Foreground="White"
                        Style="{StaticResource ActionButtonStyle}"
                        Height="45"
                        FontSize="14"
                        Margin="0,0,0,8"
                        Command="{Binding RunListCommand}"
                        IsEnabled="{Binding CanRun}" />

                <Button Content="⏸ 일시정지"
                        Background="#FF9800"
                        Foreground="White"
                        Style="{StaticResource ActionButtonStyle}"
                        Margin="0,0,0,8"
                        Command="{Binding PauseListCommand}"
                        IsEnabled="{Binding IsRunning}" />

                <Button Content="⏹ 중단"
                        Background="#F44336"
                        Foreground="White"
                        Style="{StaticResource ActionButtonStyle}"
                        Margin="0,0,0,15"
                        Command="{Binding AbortListCommand}"
                        IsEnabled="{Binding IsRunning}" />

                <!-- SCPI 명령어 -->
                <Border Background="#F5F5F5"
                        BorderBrush="#BDBDBD"
                        BorderThickness="1"
                        Padding="8">
                    <StackPanel>
                        <TextBlock Text="SCPI Commands"
                                   FontWeight="Bold"
                                   FontSize="10"
                                   Foreground="Gray"
                                   Margin="0,0,0,5" />
                        <TextBlock Text="Enable: :LIST:STATe ON"
                                   FontSize="9"
                                   FontFamily="Consolas"
                                   Foreground="#424242" />
                        <TextBlock Text="Set: :LIST:CURRent {values}"
                                   FontSize="9"
                                   FontFamily="Consolas"
                                   Foreground="#424242"
                                   Margin="0,2" />
                        <TextBlock Text="Run: :LIST:RUN"
                                   FontSize="9"
                                   FontFamily="Consolas"
                                   Foreground="#424242"
                                   Margin="0,2" />
                        <TextBlock Text="Abort: :LIST:ABORt"
                                   FontSize="9"
                                   FontFamily="Consolas"
                                   Foreground="#424242"
                                   Margin="0,2" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- 하단 버튼 영역 -->
        <Grid Grid.Row="2"
              Margin="0,15,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- 장비에 업로드 -->
            <Button Grid.Column="0"
                    Content="📤 Upload to Device"
                    Background="#2196F3"
                    Foreground="White"
                    FontWeight="Bold"
                    Height="40"
                    FontSize="12"
                    Command="{Binding UploadToDeviceCommand}" />

            <!-- 장비에서 다운로드 -->
            <Button Grid.Column="2"
                    Content="📥 Download from Device"
                    Background="#9C27B0"
                    Foreground="White"
                    FontWeight="Bold"
                    Height="40"
                    FontSize="12"
                    Command="{Binding DownloadFromDeviceCommand}" />

            <!-- 파일로 저장 -->
            <Button Grid.Column="4"
                    Content="💾 Save to File"
                    Background="#607D8B"
                    Foreground="White"
                    FontWeight="Bold"
                    Height="40"
                    FontSize="12"
                    Command="{Binding SaveToFileCommand}" />

            <!-- 닫기 -->
            <Button Grid.Column="6"
                    Content="Close"
                    Background="#757575"
                    Foreground="White"
                    FontWeight="Bold"
                    Height="40"
                    FontSize="12"
                    Command="{Binding CloseCommand}" />
        </Grid>
    </Grid>
</Window>
